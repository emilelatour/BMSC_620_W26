{
  "hash": "b32cc56ee9223c95493fb1b56076f295",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"BMSC 620 — Homework 7\"\nsubtitle: \"Chi-Squared Tests, Fisher's Exact Test, and Power for Proportions\"\nauthor: \"Your Name\"\nformat: \n  html:\n    embed-resources: true\n    toc: true\n    self-contained: true\nexecute:\n  echo: true\n  eval: true\n---\n\n\n\n\n\n::: {.callout-note}\n**File naming and submission**\n\nPlease use the following file naming convention:\n\n`Lastname_FirstInitial_HW07`\n\nExamples:\n\n- Smith_J_HW07.qmd\n- Smith_J_HW07.html\n\nWhen submitting Homework 7, upload **both**:\n\n- the `.qmd` file\n- the rendered `.html` file\n:::\n\n## Instructions\n\n- Answer each question clearly and concisely.\n- Show your work using R code chunks.\n- **Rounding:** Round proportions to 3 decimal places.\n  Round *p*-values to 3 decimal places (or report as *p* < 0.001 if very small).\n- This homework uses an **external data file** — see Part 0 below before writing\n  any code.\n- Code chunks marked `# Your code here` are intentionally blank. You are\n  expected to write the code yourself. Hints are provided to guide you.\n\n::: {.callout-note}\n**A note on this homework**\n\nThis assignment builds on what you learned about inference for proportions\n(Homework 6) and extends it to more complex categorical data. Parts 1–2 apply\nthe chi-squared test to a multi-group comparison. Part 3 introduces Fisher's\nexact test for small samples. Part 4 covers power analysis for comparing two\nproportions, and Part 5 introduces McNemar's test for paired (correlated)\nproportions — a common scenario when the same subjects are measured at two\ntime points.\n:::\n\n---\n\n## Part 0: Project Setup\n\n**Before writing any code, do the following:**\n\n1. Make sure you are working inside your BMSC 620 R Project.\n2. Download the data file from OneDrive and place it inside your\n   project's `data/` folder:\n   - `smoking_cessation.xlsx`\n3. Your folder structure should look like this:\n\n```\nBMSC620/\n├── BMSC620.Rproj\n├── data/\n│   ├── smoking_cessation.xlsx\n└── homework/\n    └── Smith_J_HW07.qmd    ← your file goes here\n```\n\nLoad the packages you will need:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(here)\nlibrary(broom)\nlibrary(rstatix)\nlibrary(janitor)\nlibrary(pwr)\nlibrary(readxl)\n```\n:::\n\n\n\n\n---\n\n## Part 1: Chi-Squared Test of Association\n\n### Background\n\nThe `smoking_cessation.xlsx` dataset comes from a simulated randomized\ncontrolled trial of **360 adults** who smoke and want to quit. Participants\nwere randomized equally to one of three smoking cessation interventions:\n\n- **Patch**: Nicotine patch alone\n- **Counseling**: Behavioral counseling alone\n- **Combined**: Nicotine patch + behavioral counseling\n\nThe primary outcome was **cessation status at 6 months** (`outcome_6mo`),\nrecorded as one of three levels: `Quit`, `Reduced` (smoking reduced by ≥ 50%),\nor `No Change`.\n\nThe dataset also includes `quit_6mo` (binary: Yes/No) and `quit_12mo`\n(binary quit status at 12 months for the same patients).\n\n> *Data simulated for educational purposes. Values do not represent real\n> patient data.*\n\n---\n\n### 1A. Load and inspect the data\n\nImport `smoking_cessation.xlsx` and assign it to an object called `smoking`.\nUse `glimpse()` to inspect the structure.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Your code here\n```\n:::\n\n\n\n\nHow many patients are in each treatment group? How many patients had each\n6-month outcome?\n\n::: {.callout-tip}\n`janitor::tabyl()` is a convenient way to count observations. Try\n`tabyl(treatment)` and `tabyl(outcome_6mo)` to answer both parts.\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Your code here\n```\n:::\n\n\n\n\n**Answer:**\n\n---\n\n### 1B. Create the contingency table\n\nCreate a two-way frequency table showing 6-month cessation outcome by\ntreatment group. Include row and column totals.\n\n::: {.callout-tip}\n`tabyl(treatment, outcome_6mo)` will cross-tabulate the two variables. Pipe\nthe result into `adorn_totals(c(\"row\", \"col\"))` to add margins.\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Your code here\n```\n:::\n\n\n\n\nLooking at the raw counts, which treatment group appears to have the highest\nquit rate? The lowest?\n\n**Answer:**\n\n---\n\n### 1C. State the hypotheses\n\nWe want to test whether there is an association between treatment group and\n6-month cessation outcome.\n\nState the null and alternative hypotheses **in words** (not symbols).\n\n**Answer:**\n\n$H_0$:\n\n$H_A$:\n\n---\n\n### 1D. Check assumptions and expected counts\n\nBefore interpreting the chi-squared test, we need to verify that the expected\ncounts are large enough.\n\n::: {.callout-tip}\nRun `chisq.test()` on the contingency table and inspect the `$expected`\nelement of the result. For a table larger than 2×2, the rule is: no more\nthan 20% of expected counts should be < 5, and **all** expected counts\nshould be ≥ 1.\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Your code here\n# Hint: save the chisq.test() result to an object, then use $expected\n```\n:::\n\n\n\n\nAre the conditions for the chi-squared test met? Briefly explain.\n\n**Answer:**\n\n---\n\n### 1E. Run the chi-squared test\n\nUse `chisq.test()` to test for an association between treatment and 6-month\noutcome. Report the test statistic, degrees of freedom, and p-value.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Your code here\n```\n:::\n\n\n\n\n---\n\n### 1F. Interpret the results\n\nWrite a 2–3 sentence conclusion in context. Be sure to:\n\n- State whether you reject or fail to reject $H_0$ at $\\alpha = 0.05$\n- Describe what the result means for the relationship between treatment and\n  cessation outcome\n- Mention the test statistic and p-value\n\n**Answer:**\n\n---\n\n## Part 2: Exploring the Association\n\n### 2A. Visualize and summarize the association\n\nThe chi-squared test tells us *that* an association exists, but not *where*\nthe differences lie. Create a **stacked proportion bar chart** showing the\ndistribution of 6-month outcomes by treatment group, and compute **row\nproportions** to quantify the differences.\n\n::: {.callout-tip}\nFor the chart, try\n`ggplot(smoking, aes(x = treatment, fill = outcome_6mo)) + geom_bar(position = \"fill\")`\nand add `+ labs(y = \"Proportion\")`.\n\nFor the proportions table, pipe your `tabyl(treatment, outcome_6mo)` into\n`adorn_percentages(\"row\")`, then `adorn_pct_formatting(digits = 1)`, and\noptionally `adorn_ns()` to show counts alongside percentages.\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Your code here\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Your code here\n```\n:::\n\n\n\n\nWhich treatment group has the highest quit rate? The highest \"No Change\"\nrate? In 1–2 sentences, describe what the chart and table reveal about how\nthe three groups differ.\n\n**Answer:**\n\n---\n\n## Part 3: Fisher's Exact Test\n\n### Background\n\nA colleague is interested in whether the combined intervention is more\neffective than the patch alone specifically among **older male smokers**\n(males aged 60 and older). They ask you to compare quit rates\n(`quit_6mo`) between the Combined and Patch groups in this subgroup.\n\n---\n\n### 3A. Create the subset\n\nFilter `smoking` to include only **males aged 60 or older** in the\n**Combined** or **Patch** treatment groups. Assign this to an object called\n`older_males`.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Your code here\n```\n:::\n\n\n\n\nHow many patients are in this subset? Create a 2×2 table of `treatment`\nby `quit_6mo`.\n\n::: {.callout-tip}\nUse `tabyl(treatment, quit_6mo)` on the filtered data and add totals.\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Your code here\n```\n:::\n\n\n\n\n**Answer:**\n\n---\n\n### 3B. Check whether chi-squared is appropriate\n\nCompute the expected counts for this 2×2 table. Are the conditions for the\nchi-squared test met?\n\n::: {.callout-tip}\nFor a **2×2 table**, the chi-squared test requires all expected counts ≥ 10.\nYou can check with `chisq.test()$expected` on the table.\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Your code here\n```\n:::\n\n\n\n\n**Answer:**\n\n---\n\n### 3C. Run Fisher's exact test\n\nSince the expected counts are too small, use Fisher's exact test to test\nwhether quit rates differ between the two treatment groups in this subgroup.\n\n::: {.callout-tip}\nYou can use `fisher.test()` on a table or matrix object. Pipe the result to\n`broom::tidy()` for a tidy output, or use `rstatix::fisher_test()` on the\ntable directly.\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Your code here\n```\n:::\n\n\n\n\n---\n\n### 3D. Interpret the results\n\nReport the p-value and the odds ratio (with 95% CI) from the Fisher's exact\ntest.\n\nWrite a 2–3 sentence conclusion. Is there evidence of a difference in quit\nrates between Combined and Patch among older males? Why is Fisher's exact\ntest the appropriate choice here?\n\n**Answer:**\n\n---\n\n## Part 4: Power Analysis for Comparing Two Proportions\n\n### Background\n\nBased on the trial results, researchers are planning a **new, larger study**\ncomparing only the Combined intervention to the Patch. From the current\ndata, they estimate:\n\n- Quit rate in the **Patch group**: approximately 21%\n- Quit rate in the **Combined group**: approximately 47%\n\nThey want to design a study with **80% power** at $\\alpha = 0.05$\n(two-sided) to detect this difference.\n\n---\n\n### 4A. Calculate Cohen's *h*\n\nBefore using `pwr.2p.test()`, compute the effect size using **Cohen's *h***,\nwhich is the appropriate effect size measure for comparing two proportions.\n\n::: {.callout-tip}\nCohen's *h* uses the arcsine transformation:\n$$h = 2 \\arcsin(\\sqrt{p_1}) - 2 \\arcsin(\\sqrt{p_2})$$\n\nThe `pwr` package provides `ES.h(p1, p2)` to compute this directly.\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Your code here\n```\n:::\n\n\n\n\nIs this a small, medium, or large effect by Cohen's conventional thresholds\n(0.2 / 0.5 / 0.8)?\n\n**Answer:**\n\n---\n\n### 4B. Find the required sample size\n\nUse `pwr.2p.test()` to determine how many participants are needed\n**per group** to achieve 80% power. Round up to the nearest whole person.\n\n::: {.callout-tip}\nLeave `n = NULL` to solve for sample size. The function returns the\nper-group *n*, so total sample size = 2 × *n*.\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Your code here\n```\n:::\n\n\n\n\nHow many participants are needed in total across both groups?\n\n**Answer:**\n\n---\n\n### 4C. Power for a budget-constrained design\n\nThe research team can only recruit **50 participants per group** (100 total).\nUsing the same effect size and significance level, what power will this\nstudy have?\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Your code here\n```\n:::\n\n\n\n\nWrite a sentence interpreting this power value.\n\n**Answer:**\n\n---\n\n### 4D. Reflect on the design\n\nThe team is considering whether 50 per group is sufficient. In 2–3\nsentences, discuss the implications of the power level you found in 4C.\nWhat are the risks of proceeding with an underpowered study?\n\n**Answer:**\n\n---\n\n## Part 5: McNemar's Test for Paired Proportions\n\n### Background\n\nThe smoking cessation trial measured quit status for the **same patients**\nat two time points: 6 months (`quit_6mo`) and 12 months (`quit_12mo`).\nResearchers want to know whether the overall quit rate **changed** between\nthese two time points across all participants, regardless of treatment group.\n\nBecause the same individuals are measured at both time points, the\nobservations are **paired** — we cannot treat these as independent\nproportions. This calls for **McNemar's test**.\n\n---\n\n### 5A. Create the paired 2×2 table\n\nCreate a 2×2 frequency table crossing `quit_6mo` (rows) by `quit_12mo`\n(columns).\n\n::: {.callout-tip}\nUse `tabyl(quit_6mo, quit_12mo)` and add totals. The **concordant** cells\n(both Yes, both No) represent patients whose status didn't change. The\n**discordant** cells are the key to McNemar's test.\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Your code here\n```\n:::\n\n\n\n\nHow many patients were **concordant** (same status at both times)?\nHow many were **discordant** (status changed)?\n\nOf the discordant patients, how many **relapsed** (quit at 6 months but\nnot at 12)? How many were **late quitters** (did not quit at 6 months but\ndid quit at 12)?\n\n**Answer:**\n\n---\n\n### 5B. State the hypotheses\n\nLet $p_{12}$ be the probability of quitting at 6 months but not at 12\n(relapse), and $p_{21}$ be the probability of not quitting at 6 months\nbut quitting at 12 (late quitting). McNemar's test focuses on whether\nthese discordant probabilities are equal.\n\nState the null and alternative hypotheses.\n\n**Answer:**\n\n$H_0$:\n\n$H_A$:\n\n---\n\n### 5C. Run McNemar's test\n\nUse `mcnemar.test()` on the 2×2 table to test whether the quit rate\nchanged from 6 to 12 months.\n\n::: {.callout-tip}\n`mcnemar.test()` expects a matrix or table object. You can create one with\n`table(smoking$quit_6mo, smoking$quit_12mo)`. By default it applies a\ncontinuity correction — this is fine for our purposes.\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Your code here\n```\n:::\n\n\n\n\n---\n\n### 5D. Interpret the results\n\nReport the test statistic, p-value, and the quit rate at each time point.\n\nWrite a 2–3 sentence conclusion. Did the overall quit rate change\nsignificantly between 6 and 12 months? What does this suggest about the\ndurability of cessation in this trial?\n\n::: {.callout-tip}\nTo compute the overall quit rate at each time point, use\n`mean(smoking$quit_6mo == \"Yes\")` and `mean(smoking$quit_12mo == \"Yes\")`.\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Your code here\n```\n:::\n\n\n\n\n**Answer:**\n\n---\n\n### 5E. Power analysis for a future paired study\n\nResearchers are planning a **new, larger study** using McNemar's test to\ndetect whether a similar cessation program changes quit rates over time.\nThey want to estimate how many patients to enroll.\n\nThe key insight from the lecture: McNemar's test only uses the **discordant\npairs**, so power depends on how many pairs change status — not the total\nsample size alone.\n\n**Step 1:** From your table in 5A, estimate the proportion of patients who\nwere discordant (i.e., whose quit status changed between 6 and 12 months).\n\n**Step 2:** Suppose the researchers expect that among discordant patients,\n**75% will be relapsers** (quit → not quit) and 25% will be late quitters.\nUnder $H_0$, discordant patients would split 50/50. Use `ES.h()` to\ncompute the effect size and `pwr.p.test()` to find how many **discordant\npairs** are needed for 80% power at $\\alpha = 0.05$ (two-sided).\n\n**Step 3:** Divide the required number of discordant pairs by your estimated\nproportion of discordant pairs from Step 1 to get the **total number of\npatients** needed.\n\n::: {.callout-tip}\nThis approach treats McNemar's test as a one-sample proportion test on the\ndiscordant pairs only. Under $H_0$, the proportion of discordant pairs that\ngo in one direction is 0.50. Use `pwr.p.test()` with\n`h = ES.h(0.75, 0.50)`.\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Step 1: proportion of discordant pairs\n# Your code here\n\n# Step 2: required number of discordant pairs\n# Your code here\n\n# Step 3: total patients needed\n# Your code here\n```\n:::\n\n\n\n\nHow many total patients would the researchers need to enroll? Why is the\ntotal *n* larger than the number of discordant pairs required?\n\n**Answer:**\n\n---\n\n## Submission checklist\n\nBefore submitting, make sure you have:\n\n- [ ] Data file is in your `data/` folder\n- [ ] All code chunks run without errors when rendered\n- [ ] Answered all written questions\n- [ ] Interpretations are written in full sentences, in context\n- [ ] Rendered your HTML successfully\n- [ ] Uploaded both `.qmd` and `.html` files\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}