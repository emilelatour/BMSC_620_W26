---
title: "Summarizing Categorical Data: Tables and Plots"
author: "Emile Latour, Nicky Wakim, Meike Niederhausen"
date: "`r library(here); source(here('class_dates.R')); w2d1`"
date-format: long
format:
  revealjs:
    theme: "../../assets/css/reveal-bmsc620_v4.scss"
    slide-number: true
    show-slide-number: all
    width: 1955
    height: 1100
    footer: "BMSC 620 | Summarizing Categorical Data"
    html-math-method: mathjax
    header-includes: |
      <style>
      #wrap {
        width: 1650px;
        height: 900px;
        margin: 0 auto;
        overflow: hidden;
        border: 1px solid #999;
        border-radius: 8px;
      }
      #frame {
        width: 1650px;
        height: 900px;
        border: 0;
        zoom: 1.25;
        -moz-transform: scale(1.25);
        -moz-transform-origin: 0 0;
      }
      /* Make selected tables bigger in RevealJS slides (robust to flextable output) */
      .reveal .tbl-big {
        font-size: 28px !important;
        /* center the output block inside the column */
        display: flex;
        justify-content: center;
      
        /* scale from center */
        transform: scale(1.6);
        transform-origin: top center;
      }
      .reveal .tbl-big table,
      .reveal .tbl-big .flextable,
      .reveal .tbl-big .flextable table {
        font-size: 28px !important;
      }
      .reveal .tbl-big td,
      .reveal .tbl-big th {
        padding: 6px 10px !important;
      }
      </style>
execute:
  echo: true
  freeze: auto
---

```{r}
#| label: "setup" 
#| include: false
#| message: false
#| warning: false

library(here)
source(here("class_dates.R"))

library(dplyr)
library(ggplot2)
library(gt)
library(janitor)
library(lamisc)       # devtools::install_github("emilelatour/lamisc") 
library(laviz)        # devtools::install_github("emilelatour/laviz") 
library(oibiostat)
library(see)


data("famuss")
data("frog")

# terminal: for icons
# quarto install extension quarto-ext/fontawesome
```

## Today’s plan

1. Summarizing categorical data (tables + bar plots)
2. R basics: writing and running code in Quarto

## Summarizing categorical data

- Last week we looked at: 
  - Variable types
  - Summarizing numerical variables
  
- Today, we focus on summarizing and *describing* categorical variables.

## What do we mean by categorical?

- Values are labels or categories
- Counts and proportions matter more than averages
- Examples from biomedicine:
  - Treatment group
  - Diagnosis
  - Sex
  - Response category (e.g., improved / unchanged / worsened)

\

- **Nominal** – labels, no order
- **Ordinal** – labels, with order

## Example dataset: FAMuSS

**Functional SNPs Associated with Muscle Size and Strength (FAMuSS)**

- Study goal: examine how **demographic, physiological, and genetic factors**
  are associated with muscle strength

- Strength measured in:
  - Dominant arm
  - Non-dominant arm
  - Before and after resistance training

- Key gene of interest:
  - **ACTN3** ("the sports gene")

- Data frame with **595 participants**

**Variables we will focus on today:**

- `sex` (Female, Male)
- `race` (African Am, Asian, Caucasian, Hispanic, Other)
- `actn3.r577x` (CC, CT, TT genotype)

(We will use other variables later in the course.)

## One categorical variable (Section 1.5)

![[Artwork by @allison_horst](https://allisonhorst.com/r-packages-functions)](/img_slides/horst_categorical_data_types.png){fig-align="center"}

## Frequency tables

- A frequency table shows the **count** in each category
- Often the first summary we compute for categorical data

\

- **Questions** it helps answer:
  - How many observations are in each category?
  - Are some categories rare?
  
## Relative frequency tables

- A relative frequency table shows **proportions** instead of counts
- Proportions often make comparisons easier

- Especially useful when:
  - Group sizes differ
  - We want to compare across studies or samples
  
## FAMuSS example

\

::: columns
::: {.column width="50%"}

### Counts 

::: {.tbl-big}
```{r}
#| echo: false

famuss |> 
  dplyr::count(actn3.r577x) |> 
  janitor::adorn_totals() |> 
  gt::gt()
```
:::

:::
::: {.column width="50%"}

### Proportions

::: {.tbl-big}
```{r}
#| echo: false

famuss |> 
  lamisc::calc_tabyl(actn3.r577x) |> 
  gt::gt()
```
::: 

:::
:::

## Bar plots for categorical data

- Bar plots visualize counts or proportions
- Each bar represents a category
- Bar height reflects frequency or proportion

**Bar plots** are used for **categorical** data

**Histograms** are used for **numerical** data

\

::: columns
::: {.column width="50%"}


```{r}
#| echo: false

ggplot(data = famuss, 
       aes(x = race)) + 
  geom_bar(stat = "count", 
           width = 0.8) +
  labs(y = "Count", x = "Race") + 
  laviz::theme_minimal_white(grid = "Y", 
                             base_size = 18) + 
  theme(plot.margin = margin(5, 5, 5, 5))

```

::: 
::: {.column width="50%"}


```{r}
#| echo: false

ggplot(data = famuss, aes(x = age)) +
  geom_histogram(color = "white") +
  labs(y = "Count", x = "Age") + 
  laviz::theme_minimal_white(grid = "Y", 
                             base_size = 18) + 
  theme(plot.margin = margin(5, 5, 5, 5))
```

:::
:::

## Visualizing a categorical variable: bar plots

\

**Height** = **count** or **proportion**

::: columns
::: {.column width="50%"}

### Counts 

```{r}
#| echo: false

ggplot(data = famuss, 
       aes(x = actn3.r577x)) + 
  geom_bar(stat = "count", 
           width = 0.8) +
  labs(y = "Count", 
       x = "Genotype") +
  laviz::theme_minimal_white(grid = "Y", 
                             base_size = 18) + 
  theme(plot.margin = margin(5, 5, 5, 5))

```

:::
::: {.column width="50%"}

### Proportions

```{r}
#| echo: false
famuss |> 
  janitor::tabyl(actn3.r577x) |> 
  ggplot(aes(x = actn3.r577x, 
             y = percent)) + 
  geom_bar(stat = "identity", 
           width = 0.8) +
  labs(y = "Proportion (0–1)", 
       x = "Genotype") + 
  laviz::theme_minimal_white(grid = "Y", 
                             base_size = 18) + 
  theme(plot.margin = margin(5, 5, 5, 5))

```

:::
:::


## Two categorical variables (Section 1.6.2)

- So far, we have summarized **one categorical variable at a time**
  - Counts
  - Proportions
  - Bar plots

- Often, we want to understand the relationship between **two categorical variables**

\

- **Examples**:
  - Genotype and sex
  - Treatment group and response
  - Exposure and disease status

\


## Contingency tables

- When we have **two categorical variables**, we summarize them with a **contingency table**
  (also called a **two-way table**)

\

- Each cell shows the **count** for a combination of categories

\

- Rows represent one variable  
- Columns represent the other variable

## Contingency table example (counts)

- **Example question**:
  - Does the distribution of genotypes differ by sex?
  
\

- These are **counts**, not proportions
- Totals appear along the margins

::: {.tbl-big}
```{r}
#| echo: false


famuss |> 
  janitor::tabyl(sex, 
                 actn3.r577x) |> 
  janitor::adorn_totals(where = "both") |> 
  janitor::adorn_title(placement = "combined") |> 
  gt::gt()
```
:::



## Marginal totals vs conditional distributions

::: columns
::: {.column width="50%"}
- **Marginal totals**
  - Summarize **one variable at a time**
  - Ignore the other variable
  - Found in the **row totals** or **column totals**

\

- **Conditional distributions**
  - Describe one variable **within levels of the other**
  - Require computing **proportions**

::: 
::: {.column width="50%"}

::: {.tbl-big}
```{r}
#| echo: false


famuss |> 
  janitor::tabyl(sex, 
                 actn3.r577x) |> 
  janitor::adorn_totals(where = "both") |> 
  janitor::adorn_title(placement = "combined") |> 
  gt::gt()
```
:::

:::
:::

## Row proportions vs column proportions (1/2)

- Which one you use depends on the **question**

- **Row proportions**
  - Condition on the **row variable**
  - Each row sums to 1 (or 100%)
  
- **Example question**: Among females, what proportion have genotype CC?


::: columns
::: {.column width="50%"}
::: {.tbl-big}
```{r}
#| echo: false


famuss |> 
  janitor::tabyl(sex, 
                 actn3.r577x) |> 
  janitor::adorn_totals(where = "col") |> 
  janitor::adorn_title(placement = "combined") |> 
  gt::gt()
```
:::

::: 
::: {.column width="50%"}

::: {.tbl-big}
```{r}
#| echo: false


famuss |> 
  janitor::tabyl(sex, 
                 actn3.r577x) |> 
  janitor::adorn_percentages(denominator = "row") |> 
  janitor::adorn_totals(where = "col") |> 
  janitor::adorn_title(placement = "combined") |> 
  gt::gt() |> 
  gt::fmt_number()
```
:::

:::
:::



## Row proportions vs column proportions (2/2)

- **Column proportions**
  - Condition on the **column variable**
  - Each column sums to 1 (or 100%)
  
- **Example question**: Among those with genotype CC, what proportion are female?


::: columns
::: {.column width="50%"}
::: {.tbl-big}
```{r}
#| echo: false


famuss |> 
  janitor::tabyl(sex, 
                 actn3.r577x) |> 
  janitor::adorn_totals(where = "row") |> 
  janitor::adorn_title(placement = "combined") |> 
  gt::gt()
```
:::

::: 
::: {.column width="50%"}

::: {.tbl-big}
```{r}
#| echo: false


famuss |> 
  janitor::tabyl(sex, 
                 actn3.r577x) |> 
  janitor::adorn_percentages(denominator = "col") |> 
  janitor::adorn_totals(where = "row") |> 
  janitor::adorn_title(placement = "combined") |> 
  gt::gt() |> 
  gt::fmt_number()
```
:::

:::
:::



## Interpreting contingency tables

- Always ask:
  - What are the **rows**?
  - What are the **columns**?
  - What is being **held fixed**?

\

- Interpretation depends on:
  - The research question
  - Which variable you condition on

## Common interpretation pitfalls

- Confusing marginal totals with conditional distributions
  - Marginal totals describe the sample overall
  - Conditional distributions describe relationships (what happens within groups)
- Comparing counts when group sizes differ
- Forgetting which variable is being conditioned on

## Visualizing two categorical variables

- Contingency tables show the numbers
- Plots help reveal patterns

\


## Bar plots example: Sex by genotype

\

::: columns
::: {.column width="33.3%"}

#### Grouped bar plot

```{r}
#| echo: false


ggplot(data = famuss, 
       aes(x = actn3.r577x, 
           fill = sex)) + 
  geom_bar(stat = "count", 
           position = "dodge", 
           width = 0.8) +
  labs(y = "Count", 
       x = "Genotype") +
  laviz::theme_minimal_white(grid = "Y", 
                             base_size = 18) + 
  theme(plot.margin = margin(5, 5, 5, 5)) + 
  see::scale_fill_okabeito()

```

::: 
::: {.column width="33.3%"}

#### Stacked bar plot 

```{r}
#| echo: false

ggplot(data = famuss, 
       aes(x = actn3.r577x, 
           fill = sex)) + 
  geom_bar(stat = "count", 
           width = 0.8) +
  labs(y = "Count", 
       x = "Genotype") +
  laviz::theme_minimal_white(grid = "Y", 
                             base_size = 18) + 
  theme(plot.margin = margin(5, 5, 5, 5)) + 
  see::scale_fill_okabeito()

```

:::
::: {.column width="33.4%"}

#### Percent stacked bar plot

```{r}
#| echo: false
famuss |> 
  ggplot(aes(x = actn3.r577x, 
             fill = sex)) + 
  geom_bar(position = "fill", 
           width = 0.8) +
  labs(y = "Proportion (0–1)", 
       x = "Genotype") + 
  laviz::theme_minimal_white(grid = "Y", 
                             base_size = 18) + 
  theme(plot.margin = margin(5, 5, 5, 5)) + 
  see::scale_fill_okabeito()

```

:::
:::


## Bar plots example: Genotype by sex

\

::: columns
::: {.column width="33.3%"}

#### Grouped bar plot

```{r}
#| echo: false


ggplot(data = famuss, 
       aes(x = sex, 
           fill = actn3.r577x)) + 
  geom_bar(stat = "count", 
           position = "dodge", 
           width = 0.8) +
  labs(y = "Count", 
       x = "Sex") +
  laviz::theme_minimal_white(grid = "Y", 
                             base_size = 18) + 
  theme(plot.margin = margin(5, 5, 5, 5)) + 
  see::scale_fill_okabeito()

```

::: 
::: {.column width="33.3%"}

#### Stacked bar plot 

```{r}
#| echo: false

ggplot(data = famuss, 
       aes(x = sex, 
           fill = actn3.r577x)) + 
  geom_bar(stat = "count", 
           width = 0.8) +
  labs(y = "Count", 
       x = "Sex") +
  laviz::theme_minimal_white(grid = "Y", 
                             base_size = 18) + 
  theme(plot.margin = margin(5, 5, 5, 5)) + 
  see::scale_fill_okabeito()

```

:::
::: {.column width="33.4%"}

#### Percent stacked bar plot

```{r}
#| echo: false
famuss |> 
  ggplot(aes(x = sex, 
           fill = actn3.r577x)) + 
  geom_bar(position = "fill", 
           width = 0.8) +
  labs(y = "Proportion (0–1)", 
       x = "Sex") + 
  laviz::theme_minimal_white(grid = "Y", 
                             base_size = 18) + 
  theme(plot.margin = margin(5, 5, 5, 5)) + 
  see::scale_fill_okabeito()

```

:::
:::

## Special case: two-by-two tables

- A **two-by-two table** is a contingency table with:
  - Two levels of one variable
  - Two levels of another variable

\

- Very common in biomedical research:
  - Exposure (Yes / No) × Outcome (Yes / No)
  - Treatment (Drug / Control) × Response (Improved / Not improved)
  - Test result (Positive / Negative) × Disease status (Present / Absent)

\

- Today:
  - Focus on **structure and interpretation**
- Later:
  - Risk, odds, probability, and inference
  
## A quick note on numeric variables

Last week, we summarized numeric variables using:

- mean and standard deviation
- median and IQR

\

We can also **summarize numeric variables visually**, just like we did for categorical data.

## Visualizing a numeric variable: histogram

- Histograms show the **distribution** of a numeric variable
- Useful for seeing:
  - shape (symmetric vs skewed)
  - outliers
  - clusters

```{r}
#| echo: false
# ggplot(famuss, aes(x = age)) +
#   geom_histogram(color = "white") +
#   labs(x = "Age", y = "Count") +
#   laviz::theme_minimal_white(grid = "Y", base_size = 18)

ggplot(frog, 
       aes(x = clutch.volume)) +
  geom_histogram(color = "white") +
  labs(x = "Clutch volume", 
       y = "Count") +
  laviz::theme_minimal_white(grid = "Y", 
                             base_size = 18)
```

## Visualizing a numeric variable: box plot

- Box plots summarize a numeric variable using:
  - median
  - IQR
  - potential outliers

\

::: columns
::: {.column width="50%"}

#### Box plot

```{r}
#| echo: false
# ggplot(famuss, aes(y = age)) +
#   geom_boxplot() +
#   labs(x = NULL, y = "Age") +
#   laviz::theme_minimal_white(grid = "Y", base_size = 18)

ggplot(frog, 
       aes(x = "1", 
       y = clutch.volume)) +
  geom_boxplot(width = 0.25) +
  labs(x = NULL, y = "Clutch volume") +
  laviz::theme_minimal_white(grid = "None", 
                             base_size = 18) + 
  scale_y_continuous(limits = c(0, 3000)) +
  theme(
    axis.text.x  = element_blank(),
    axis.ticks.x = element_blank(),
    axis.line.x  = element_blank()
  )

```

:::
::: {.column width="50%"}

#### Box plot by groups

```{r}
#| echo: false
# ggplot(famuss, aes(y = age)) +
#   geom_boxplot() +
#   labs(x = NULL, y = "Age") +
#   laviz::theme_minimal_white(grid = "Y", base_size = 18)


frog |> 
  mutate(altitude = as.character(altitude), 
         altitude = as.numeric(gsub(",", "", altitude)), 
         altitude = as.numeric(altitude)) |> 
  mutate(altitude = cut(altitude, 
                        breaks = c(2000, 2500, 3000, 3500), 
                        labels = c("2000–2500", "2500–3000", "3000–3500"))) |> 
  ggplot(aes(x = altitude, 
       y = clutch.volume)) +
  geom_boxplot(width = 0.25) +
  labs(x = "Altitude", 
       y = "Clutch volume") +
  laviz::theme_minimal_white(grid = "None", 
                             base_size = 18) + 
  scale_y_continuous(limit = c(0, 3000))

```

:::
:::

## Box plot legend

```{r}
#| echo: false

laviz::ggplot_box_legend()
```


## Wrap-up

Today you learned how to:

- Summarize categorical variables (counts + proportions)
- Compare two categorical variables (contingency tables)
- Interpret row vs column percentages
- Use bar plots, histograms, and box plots as quick visual summaries
